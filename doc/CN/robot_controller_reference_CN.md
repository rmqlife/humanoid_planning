# 机器人控制器参考

本文档是fourier-aurora及其扩展包中提供的控制器参考。控制器以FSM状态中的**任务**形式提供。Aurora运行一个FSM状态机，每个状态对应特定的任务(控制器)。您可以通过摇杆或DDS接口发送命令在这些状态之间切换。每个任务都有自己的输入和输出。

Aurora提供了一系列可用于控制机器人运动的控制器。一些通用控制器包含在`fourier-aurora`包中，而其他控制器则根据机器人配置包含在扩展包中，例如GR-2机器人的`fourier-aurora-gr2`包。

关于DDS接口参考，请参阅[DDS接口参考](aurora_dds_reference_CN.md)。

## 通用控制器

状态名称 | 任务名称 | 摇杆映射 | DDS映射 | 描述
-----------|-----------|------------------|------------|------------
Default | DefaultTask | LB+RB | 0 | 默认状态，不执行任何操作，用作FSM启动后的默认状态。
SecurityProtection | SecurityProtectionTask | LT+RT | 9 | 安全状态，紧急情况下停止所有执行器。退出此状态时将重新激活执行器。
JointStand | JointStandTask | LB+A | 1 | 所有执行器移动到零位。用于检查所有执行器关节是否正常工作并完成零位校准。
PdStand | PdStandTask | LB+B | 2 | 机器人在平面上站立，支持上半身关节(腰部、手臂和头部)的外部关节位置命令，以及包括基座高度、俯仰和偏航在内的站立姿势调整。
UserCmd | UserCmdTask | - | 10 | 执行外部关节控制和配置命令。
UpperBodyUserCmd | UpperBodyUserCmdTask | - | 11 | 执行上半身关节(腰部、手臂和头部)的外部关节控制和配置命令。

#### PdStand任务规范

此任务用于使机器人在平面上站立以便进一步控制。切换到PdStand状态时，如果机器人处于悬挂状态，它将首先弯曲膝盖准备站立。然后您可以将机器人垂直放置在平面上(z轴无外力，例如悬挂电缆)。当稳定级别达到100时，机器人将进入站立状态，用户可以使用上半身关节(腰部、手臂和头部)的外部关节位置命令以及基座高度、俯仰和偏航的增量格式命令(相对于初始姿势)来控制机器人。

输入:
- 上半身关节(腰部、手臂和头部)的外部关节位置命令。
    - 单位: 弧度
    - 范围: 根据urdf关节限制
    - 注意: 仅在机器人处于站立状态时生效

- 基座高度、俯仰和偏航的增量格式命令(相对于初始姿势)。
    - 单位: 高度为米，俯仰和偏航为弧度
    - 范围(gr2): delta_z [-0.2, 0.025], delta_pitch [-0.3, 0.45], delta_yaw [-0.5, 0.5]
    - 注意: 仅在机器人处于站立状态时生效

输出:
- 基座高度、俯仰和偏航的增量格式状态(相对于初始姿势)。
    - 单位: 高度为米，俯仰和偏航为弧度
    - 范围: delta_z [-0.2, 0.025], delta_pitch [-0.3, 0.45], delta_yaw [-0.5, 0.5]
    - 注意: 仅在机器人处于站立状态时生效

- 稳定级别
    - 单位: -
    - 范围: 真实机器人为[0,110]，模拟器为[0,15]
    - 注意: 当稳定级别低于100时，真实机器人将进入悬挂状态

#### UserCmd任务规范

此任务用于执行外部关节控制和配置命令。切换到UserCmd状态后，用户可以发送所有关节的外部关节位置命令和外部配置命令(如pd参数)。机器人将执行这些命令并相应地更新其状态。

输入:
- 所有关节的外部关节位置命令。
    - 单位: 位置参考为弧度，速度参考为弧度/秒，力矩前馈为牛米
    - 范围: 根据urdf关节限制

- 外部配置命令如pd参数。
    - 单位: -
    - 范围: -

#### UpperBodyUserCmd任务规范

此任务用于执行上半身关节(腰部、手臂和头部)的外部关节控制和配置命令。切换到UpperBodyUserCmd状态后，腿部执行器将被禁用直到退出此状态。

输入:
- 上半身关节(腰部、手臂和头部)的外部关节位置命令。
    - 单位: 位置参考为弧度，速度参考为弧度/秒，力矩前馈为牛米
    - 范围: 根据urdf关节限制

- 外部配置命令如pd参数。
    - 单位: -
    - 范围: -

## GR-2控制器

状态名称 | 任务名称 | 摇杆映射 | DDS映射 | 描述
-----------|-----------|------------------|------------|------------
UserController_A | LowerBodyCpgTask UpperBodyStateManagerTask | LB+A | 3 | RL策略行走，接收外部速度命令(vx, vy, vyaw)，支持上半身关节(腰部、手臂和头部)的外部关节控制命令

#### LowerBodyCpgTask规范

此任务用于通过策略控制下半身关节(髋部、膝盖和脚踝)，使机器人能够行走。建议先切换到pd站立状态以确保机器人在平面上站立。切换到LowerBodyCpgTask状态后，机器人将执行CPG策略来控制下半身关节。

输入:
- 速度命令(vx, vy, vyaw)。
    - 单位: vx和vy为米/秒，vyaw为弧度/秒
    - 范围: 根据机器人能力

#### UpperBodyStateManagerTask规范

此任务用于管理上半身关节(腰部、手臂和头部)。通常与下半身控制器结合使用。切换到UpperBodyStateManagerTask状态后，机器人将执行状态机来管理上半身关节。初始状态为"default"。用户可以切换到其他状态使手臂摆动或接收上半身关节(腰部、手臂和头部)的外部关节控制命令。**目前建议使用pd站立进行上半身站立控制以获得更好的稳定性。**

输入:
- 上半身状态切换命令。
    - 单位: -
    - 范围: 0 默认, 1 下半身-上半身联动, 2 远程控制
- 上半身关节(腰部、手臂和头部)的外部关节位置命令。
    - 单位: 位置参考为弧度，速度参考为弧度/秒，力矩前馈为牛米
    - 范围: 根据urdf关节限制
    - 注意: 仅在上半身状态为"远程控制"时生效
